const express = require('express')
const app = express()
const port = 3000
var cdt2d = require('cdt2d')

app.get('/', (req, res) => {
    const w7cData = {
        "charts": [{
            "column": 0,
            "row": 0,
            "title": "BIBER Iso Velocities",
            "subtitle": null,
            "additonalInfo": {
                "data": {
                    "z": [[0.0,
                        0.0241,
                        0.102,
                        0.1229,
                        0.1625,
                        0.2073,
                        0.175,
                        0.2165,
                        0.2179,
                        0.2113,
                        0.2632,
                        0.2559,
                        0.2355,
                        0.1878,
                        0.1817,
                        0.1766,
                        0.1625,
                        0.18,
                        0.1168,
                        0.1077,
                        0.0],
                    [0.0,
                        0.0235,
                        0.1005,
                        0.121,
                        0.1601,
                        0.2042,
                        0.1724,
                        0.2132,
                        0.2147,
                        0.2082,
                        0.2593,
                        0.2521,
                        0.232,
                        0.185,
                        0.179,
                        0.1739,
                        0.1601,
                        0.1759,
                        0.1132,
                        0.1043,
                        0.0],
                    [0.0,
                        0.0233,
                        0.0997,
                        0.1201,
                        0.1588,
                        0.2026,
                        0.171,
                        0.2115,
                        0.2129,
                        0.2065,
                        0.2572,
                        0.25,
                        0.2301,
                        0.1835,
                        0.1775,
                        0.1725,
                        0.1574,
                        0.171,
                        0.1099,
                        0.1001,
                        0.0],
                    [0.0,
                        0.0229,
                        0.0988,
                        0.119,
                        0.1574,
                        0.2008,
                        0.1695,
                        0.2097,
                        0.2111,
                        0.2047,
                        0.2549,
                        0.2479,
                        0.2281,
                        0.1835,
                        0.176,
                        0.171,
                        0.1545,
                        0.1652,
                        0.1058,
                        0.0945,
                        null],
                    [0.0,
                        0.0224,
                        0.0969,
                        0.1168,
                        0.156,
                        0.199,
                        0.1679,
                        0.2077,
                        0.2092,
                        0.2028,
                        0.2526,
                        0.2432,
                        0.226,
                        0.182,
                        0.1727,
                        0.1678,
                        0.1511,
                        0.1579,
                        0.1006,
                        0.0884,
                        null],
                    [null,
                        0.0218,
                        0.0959,
                        0.1155,
                        0.1528,
                        0.197,
                        0.1663,
                        0.2057,
                        0.2071,
                        0.2008,
                        0.2501,
                        0.2406,
                        0.2214,
                        0.1803,
                        0.1708,
                        0.166,
                        0.1472,
                        0.1476,
                        0.0928,
                        0.0702,
                        null],
                    [null,
                        0.0211,
                        0.0948,
                        0.1142,
                        0.1511,
                        0.195,
                        0.1645,
                        0.2012,
                        0.2026,
                        0.1987,
                        0.2475,
                        0.2379,
                        0.2189,
                        0.1785,
                        0.1689,
                        0.1641,
                        0.1426,
                        0.1295,
                        0.0762,
                        null,
                        null],
                    [null,
                        0.0203,
                        0.0924,
                        0.1128,
                        0.1492,
                        0.1904,
                        0.1627,
                        0.1987,
                        0.2001,
                        0.1965,
                        0.2416,
                        0.2349,
                        0.2162,
                        0.1766,
                        0.1668,
                        0.1599,
                        0.1399,
                        0,
                        null,
                        null,
                        null],
                    [null,
                        0.0191,
                        0.091,
                        0.1096,
                        0.1472,
                        0.1878,
                        0.1606,
                        0.1961,
                        0.1974,
                        0.194,
                        0.2384,
                        0.2283,
                        0.2133,
                        0.1746,
                        0.1621,
                        0.1575,
                        0.1333,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        0.0173,
                        0.0895,
                        0.1078,
                        0.1426,
                        0.185,
                        0.1585,
                        0.1931,
                        0.1944,
                        0.1885,
                        0.2348,
                        0.2245,
                        0.2066,
                        0.1701,
                        0.1594,
                        0.1549,
                        0.124,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        0,
                        0.0859,
                        0.1058,
                        0.1399,
                        0.1819,
                        0.1561,
                        0.1899,
                        0.1912,
                        0.1854,
                        0.2309,
                        0.2203,
                        0.2027,
                        0.1701,
                        0.1564,
                        0.1487,
                        0.106,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        null,
                        0.0837,
                        0.1008,
                        0.1369,
                        0.1785,
                        0.1535,
                        0.1863,
                        0.1835,
                        0.1819,
                        0.2265,
                        0.2099,
                        0.1983,
                        0.1648,
                        0.153,
                        0.1448,
                        null,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        null,
                        0.0811,
                        0.0976,
                        0.1333,
                        0.1746,
                        0.1473,
                        0.1776,
                        0.1788,
                        0.1779,
                        0.2216,
                        0.2033,
                        0.1932,
                        0.1648,
                        0.1444,
                        0.1403,
                        null,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        null,
                        0.0734,
                        0.0937,
                        0.124,
                        0.1648,
                        0.1435,
                        0.172,
                        0.1732,
                        0.1734,
                        0.2091,
                        0.1951,
                        0.1796,
                        0.1617,
                        0.1386,
                        0.1271,
                        null,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        null,
                        0.0665,
                        0.0884,
                        0.117,
                        0.1581,
                        0.139,
                        0.1651,
                        0.1662,
                        0.1679,
                        0.2007,
                        0.1842,
                        0.1695,
                        0.1582,
                        0.1308,
                        0.1151,
                        null,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        null,
                        0,
                        0,
                        0.106,
                        0.1492,
                        0.1334,
                        0.1558,
                        0.1568,
                        0.1612,
                        0.1894,
                        0,
                        0.1535,
                        0.1541,
                        0.1184,
                        0,
                        null,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        null,
                        null,
                        null,
                        0,
                        0.1352,
                        0.1259,
                        0.1411,
                        0,
                        0.1521,
                        0.1716,
                        null,
                        0,
                        0.1493,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        null,
                        null,
                        null,
                        null,
                        0,
                        0.1141,
                        0,
                        null,
                        0,
                        0,
                        null,
                        null,
                        0.1433,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        0,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        0.1352,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null],
                    [null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        0,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null]],
                    "y": [0,
                        0.037,
                        0.074,
                        0.111,
                        0.148,
                        0.185,
                        0.222,
                        0.259,
                        0.296,
                        0.333,
                        0.37,
                        0.407,
                        0.444,
                        0.481,
                        0.518,
                        0.555,
                        0.592,
                        0.629,
                        0.666,
                        0.703],
                    "x": [1.999,
                        3,
                        4,
                        5.5,
                        7,
                        8.5,
                        10,
                        11.5,
                        13,
                        14.5,
                        16,
                        17.5,
                        19,
                        20.5,
                        22,
                        23.5,
                        25,
                        26.5,
                        28,
                        29,
                        30.001]
                }
            },
            "xaxis": [{
                "label": "Distance",
                "unit": "m",
                "yaxis": [{
                    "label": "Height",
                    "unit": "m",
                    "plots": [{
                        "label": "Ground",
                        "data": [[1.999,
                            0.17],
                        [3,
                            0.37],
                        [4,
                            0.56],
                        [5.5,
                            0.58],
                        [7,
                            0.6],
                        [8.5,
                            0.64],
                        [10,
                            0.68],
                        [11.5,
                            0.63],
                        [13,
                            0.62],
                        [14.5,
                            0.66],
                        [16,
                            0.64],
                        [17.5,
                            0.58],
                        [19,
                            0.6],
                        [20.5,
                            0.74],
                        [22,
                            0.59],
                        [23.5,
                            0.56],
                        [25,
                            0.4],
                        [26.5,
                            0.26],
                        [28,
                            0.24],
                        [29,
                            0.2],
                        [30.001,
                            0.08]]
                    },
                    {
                        "label": "Surface",
                        "data": [[30.001,
                            0],
                        [29,
                            0],
                        [28,
                            0],
                        [26.5,
                            0],
                        [25,
                            0],
                        [23.5,
                            0],
                        [22,
                            0],
                        [20.5,
                            0],
                        [19,
                            0],
                        [17.5,
                            0],
                        [16,
                            0],
                        [14.5,
                            0],
                        [13,
                            0],
                        [11.5,
                            0],
                        [10,
                            0],
                        [8.5,
                            0],
                        [7,
                            0],
                        [5.5,
                            0],
                        [4,
                            0],
                        [3,
                            0],
                        [1.999,
                            0]]
                    },
                    {
                        "label": "Verticals",
                        "data": [[1.999,
                            0],
                        [1.999,
                            0.17],
                        [null,
                            null],
                        [3,
                            0],
                        [3,
                            0.37],
                        [null,
                            null],
                        [4,
                            0],
                        [4,
                            0.56],
                        [null,
                            null],
                        [5.5,
                            0],
                        [5.5,
                            0.58],
                        [null,
                            null],
                        [7,
                            0],
                        [7,
                            0.6],
                        [null,
                            null],
                        [8.5,
                            0],
                        [8.5,
                            0.64],
                        [null,
                            null],
                        [10,
                            0],
                        [10,
                            0.68],
                        [null,
                            null],
                        [11.5,
                            0],
                        [11.5,
                            0.63],
                        [null,
                            null],
                        [13,
                            0],
                        [13,
                            0.62],
                        [null,
                            null],
                        [14.5,
                            0],
                        [14.5,
                            0.66],
                        [null,
                            null],
                        [16,
                            0],
                        [16,
                            0.64],
                        [null,
                            null],
                        [17.5,
                            0],
                        [17.5,
                            0.58],
                        [null,
                            null],
                        [19,
                            0],
                        [19,
                            0.6],
                        [null,
                            null],
                        [20.5,
                            0],
                        [20.5,
                            0.74],
                        [null,
                            null],
                        [22,
                            0],
                        [22,
                            0.59],
                        [null,
                            null],
                        [23.5,
                            0],
                        [23.5,
                            0.56],
                        [null,
                            null],
                        [25,
                            0],
                        [25,
                            0.4],
                        [null,
                            null],
                        [26.5,
                            0],
                        [26.5,
                            0.26],
                        [null,
                            null],
                        [28,
                            0],
                        [28,
                            0.24],
                        [null,
                            null],
                        [29,
                            0],
                        [29,
                            0.2],
                        [null,
                            null],
                        [30.001,
                            0],
                        [30.001,
                            0.08],
                        [null,
                            null]]
                    },
                    {
                        "label": "Raster",
                        "data": [[1.999,
                            0],
                        [3,
                            0],
                        [4,
                            0],
                        [5.5,
                            0],
                        [7,
                            0],
                        [8.5,
                            0],
                        [10,
                            0],
                        [11.5,
                            0],
                        [13,
                            0],
                        [14.5,
                            0],
                        [16,
                            0],
                        [17.5,
                            0],
                        [19,
                            0],
                        [20.5,
                            0],
                        [22,
                            0],
                        [23.5,
                            0],
                        [25,
                            0],
                        [26.5,
                            0],
                        [28,
                            0],
                        [29,
                            0],
                        [30.001,
                            0],
                        [1.999,
                            0.037],
                        [3,
                            0.037],
                        [4,
                            0.037],
                        [5.5,
                            0.037],
                        [7,
                            0.037],
                        [8.5,
                            0.037],
                        [10,
                            0.037],
                        [11.5,
                            0.037],
                        [13,
                            0.037],
                        [14.5,
                            0.037],
                        [16,
                            0.037],
                        [17.5,
                            0.037],
                        [19,
                            0.037],
                        [20.5,
                            0.037],
                        [22,
                            0.037],
                        [23.5,
                            0.037],
                        [25,
                            0.037],
                        [26.5,
                            0.037],
                        [28,
                            0.037],
                        [29,
                            0.037],
                        [30.001,
                            0.037],
                        [1.999,
                            0.074],
                        [3,
                            0.074],
                        [4,
                            0.074],
                        [5.5,
                            0.074],
                        [7,
                            0.074],
                        [8.5,
                            0.074],
                        [10,
                            0.074],
                        [11.5,
                            0.074],
                        [13,
                            0.074],
                        [14.5,
                            0.074],
                        [16,
                            0.074],
                        [17.5,
                            0.074],
                        [19,
                            0.074],
                        [20.5,
                            0.074],
                        [22,
                            0.074],
                        [23.5,
                            0.074],
                        [25,
                            0.074],
                        [26.5,
                            0.074],
                        [28,
                            0.074],
                        [29,
                            0.074],
                        [30.001,
                            0.074],
                        [1.999,
                            0.111],
                        [3,
                            0.111],
                        [4,
                            0.111],
                        [5.5,
                            0.111],
                        [7,
                            0.111],
                        [8.5,
                            0.111],
                        [10,
                            0.111],
                        [11.5,
                            0.111],
                        [13,
                            0.111],
                        [14.5,
                            0.111],
                        [16,
                            0.111],
                        [17.5,
                            0.111],
                        [19,
                            0.111],
                        [20.5,
                            0.111],
                        [22,
                            0.111],
                        [23.5,
                            0.111],
                        [25,
                            0.111],
                        [26.5,
                            0.111],
                        [28,
                            0.111],
                        [29,
                            0.111],
                        [1.999,
                            0.148],
                        [3,
                            0.148],
                        [4,
                            0.148],
                        [5.5,
                            0.148],
                        [7,
                            0.148],
                        [8.5,
                            0.148],
                        [10,
                            0.148],
                        [11.5,
                            0.148],
                        [13,
                            0.148],
                        [14.5,
                            0.148],
                        [16,
                            0.148],
                        [17.5,
                            0.148],
                        [19,
                            0.148],
                        [20.5,
                            0.148],
                        [22,
                            0.148],
                        [23.5,
                            0.148],
                        [25,
                            0.148],
                        [26.5,
                            0.148],
                        [28,
                            0.148],
                        [29,
                            0.148],
                        [3,
                            0.185],
                        [4,
                            0.185],
                        [5.5,
                            0.185],
                        [7,
                            0.185],
                        [8.5,
                            0.185],
                        [10,
                            0.185],
                        [11.5,
                            0.185],
                        [13,
                            0.185],
                        [14.5,
                            0.185],
                        [16,
                            0.185],
                        [17.5,
                            0.185],
                        [19,
                            0.185],
                        [20.5,
                            0.185],
                        [22,
                            0.185],
                        [23.5,
                            0.185],
                        [25,
                            0.185],
                        [26.5,
                            0.185],
                        [28,
                            0.185],
                        [29,
                            0.185],
                        [3,
                            0.222],
                        [4,
                            0.222],
                        [5.5,
                            0.222],
                        [7,
                            0.222],
                        [8.5,
                            0.222],
                        [10,
                            0.222],
                        [11.5,
                            0.222],
                        [13,
                            0.222],
                        [14.5,
                            0.222],
                        [16,
                            0.222],
                        [17.5,
                            0.222],
                        [19,
                            0.222],
                        [20.5,
                            0.222],
                        [22,
                            0.222],
                        [23.5,
                            0.222],
                        [25,
                            0.222],
                        [26.5,
                            0.222],
                        [28,
                            0.222],
                        [3,
                            0.259],
                        [4,
                            0.259],
                        [5.5,
                            0.259],
                        [7,
                            0.259],
                        [8.5,
                            0.259],
                        [10,
                            0.259],
                        [11.5,
                            0.259],
                        [13,
                            0.259],
                        [14.5,
                            0.259],
                        [16,
                            0.259],
                        [17.5,
                            0.259],
                        [19,
                            0.259],
                        [20.5,
                            0.259],
                        [22,
                            0.259],
                        [23.5,
                            0.259],
                        [25,
                            0.259],
                        [26.5,
                            0.259],
                        [3,
                            0.296],
                        [4,
                            0.296],
                        [5.5,
                            0.296],
                        [7,
                            0.296],
                        [8.5,
                            0.296],
                        [10,
                            0.296],
                        [11.5,
                            0.296],
                        [13,
                            0.296],
                        [14.5,
                            0.296],
                        [16,
                            0.296],
                        [17.5,
                            0.296],
                        [19,
                            0.296],
                        [20.5,
                            0.296],
                        [22,
                            0.296],
                        [23.5,
                            0.296],
                        [25,
                            0.296],
                        [3,
                            0.333],
                        [4,
                            0.333],
                        [5.5,
                            0.333],
                        [7,
                            0.333],
                        [8.5,
                            0.333],
                        [10,
                            0.333],
                        [11.5,
                            0.333],
                        [13,
                            0.333],
                        [14.5,
                            0.333],
                        [16,
                            0.333],
                        [17.5,
                            0.333],
                        [19,
                            0.333],
                        [20.5,
                            0.333],
                        [22,
                            0.333],
                        [23.5,
                            0.333],
                        [25,
                            0.333],
                        [3,
                            0.37],
                        [4,
                            0.37],
                        [5.5,
                            0.37],
                        [7,
                            0.37],
                        [8.5,
                            0.37],
                        [10,
                            0.37],
                        [11.5,
                            0.37],
                        [13,
                            0.37],
                        [14.5,
                            0.37],
                        [16,
                            0.37],
                        [17.5,
                            0.37],
                        [19,
                            0.37],
                        [20.5,
                            0.37],
                        [22,
                            0.37],
                        [23.5,
                            0.37],
                        [25,
                            0.37],
                        [4,
                            0.407],
                        [5.5,
                            0.407],
                        [7,
                            0.407],
                        [8.5,
                            0.407],
                        [10,
                            0.407],
                        [11.5,
                            0.407],
                        [13,
                            0.407],
                        [14.5,
                            0.407],
                        [16,
                            0.407],
                        [17.5,
                            0.407],
                        [19,
                            0.407],
                        [20.5,
                            0.407],
                        [22,
                            0.407],
                        [23.5,
                            0.407],
                        [4,
                            0.444],
                        [5.5,
                            0.444],
                        [7,
                            0.444],
                        [8.5,
                            0.444],
                        [10,
                            0.444],
                        [11.5,
                            0.444],
                        [13,
                            0.444],
                        [14.5,
                            0.444],
                        [16,
                            0.444],
                        [17.5,
                            0.444],
                        [19,
                            0.444],
                        [20.5,
                            0.444],
                        [22,
                            0.444],
                        [23.5,
                            0.444],
                        [4,
                            0.481],
                        [5.5,
                            0.481],
                        [7,
                            0.481],
                        [8.5,
                            0.481],
                        [10,
                            0.481],
                        [11.5,
                            0.481],
                        [13,
                            0.481],
                        [14.5,
                            0.481],
                        [16,
                            0.481],
                        [17.5,
                            0.481],
                        [19,
                            0.481],
                        [20.5,
                            0.481],
                        [22,
                            0.481],
                        [23.5,
                            0.481],
                        [4,
                            0.518],
                        [5.5,
                            0.518],
                        [7,
                            0.518],
                        [8.5,
                            0.518],
                        [10,
                            0.518],
                        [11.5,
                            0.518],
                        [13,
                            0.518],
                        [14.5,
                            0.518],
                        [16,
                            0.518],
                        [17.5,
                            0.518],
                        [19,
                            0.518],
                        [20.5,
                            0.518],
                        [22,
                            0.518],
                        [23.5,
                            0.518],
                        [4,
                            0.555],
                        [5.5,
                            0.555],
                        [7,
                            0.555],
                        [8.5,
                            0.555],
                        [10,
                            0.555],
                        [11.5,
                            0.555],
                        [13,
                            0.555],
                        [14.5,
                            0.555],
                        [16,
                            0.555],
                        [17.5,
                            0.555],
                        [19,
                            0.555],
                        [20.5,
                            0.555],
                        [22,
                            0.555],
                        [23.5,
                            0.555],
                        [7,
                            0.592],
                        [8.5,
                            0.592],
                        [10,
                            0.592],
                        [11.5,
                            0.592],
                        [13,
                            0.592],
                        [14.5,
                            0.592],
                        [16,
                            0.592],
                        [19,
                            0.592],
                        [20.5,
                            0.592],
                        [8.5,
                            0.629],
                        [10,
                            0.629],
                        [11.5,
                            0.629],
                        [14.5,
                            0.629],
                        [16,
                            0.629],
                        [20.5,
                            0.629],
                        [10,
                            0.666],
                        [20.5,
                            0.666],
                        [20.5,
                            0.703]]
                    }]
                }]
            }]
        }]
    }
    const x = w7cData['charts'][0]['additonalInfo']['data'].x;
    const y = w7cData['charts'][0]['additonalInfo']['data'].y;
    const z = w7cData['charts'][0]['additonalInfo']['data'].z;
    let dataChartContour = [];
    for (let i = 0; i < y.length; i++) {
        for (let j = 0; j < x.length; j++) {
            dataChartContour.push([x[j], y[i], z[i][j]]);
        }
    }
    dataChartContour.sort((a, b) => {
        return a[0] - b[0];
    })

    // Your current data array, each with X, Y and Value
    dataPoints = dataChartContour;
    
    //Array of your data points that represent the boundary, ordered
    boundaryIndexes = [4, 30, 55, 75, 96, 117, 138, 157, 176, 197, 217, 235, 256, 279, 295, 315, 330, 347, 366, 385, 402];

    // Convert to array of [ [x0, y0], [x1, y1], ....]
    _2dPoints =  [];
    for(let i = 0; i < dataPoints.length; i++) {
        _2dPoints.push([dataPoints[i][0], dataPoints[i][1]])
    }

    //Convert boundaryIndexes in a list of edges
    constraintEdges = []
    for (var i = 0; i < boundaryIndexes.length; i++) {
        constraintEdges.push([boundaryIndexes[i], boundaryIndexes[(i + 1) % boundaryIndexes.length]]);
    }

    //Use cdt2d to perform triangulation
    triangles =  cdt2d(_2dPoints, constraintEdges, {exterior: false});
    res.json(triangles);
})

app.listen(port, () => console.log(`Example app listening on port ${port}!`))